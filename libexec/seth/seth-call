#!/usr/bin/env bash
### seth-call -- call a contract without updating the blockchain
### Usage: seth call [-f <account>] [-v <value>] <receiver> [<calldata>]
###    or: seth call [-f <account>] [-v <value>] <receiver> <sig> [<args>]
###
### Perform a local call to <receiver> without creating a transaction.
###
### With `-f <account>', simulate calling <receiver> from <account>
### With `-v <value>', simulate transferring <value> to <receiver>.
### With `-b <block>', use the state of the blockchain as of <block>.
###
### If no <calldata> is given, read it from standard input instead.

set -e
receiver=`seth --to-hexdata "${1?missing receiver}"`
calldata=`seth calldata ${2+"${@:2}"}`
result=$(seth --jsonrpc eth_call \
  -n {}                          \
    -s $calldata -i data         \
    -s $receiver -i to           \
    `seth --send-params`         \
  -iappend                       \
  ${SETH_BLOCK+-s "$SETH_BLOCK" -iappend})
seth --decode "$2" <<<"$result"

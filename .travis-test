#!/usr/bin/env bash
set -ex
ETHRUN=https://github.com/dapphub/ethrun/releases/download/v0.2.4/ethrun-v0.2.4-linux.tar.gz
( cd /tmp; curl -LO "$ETHRUN"; tar xf *.tar.gz; sudo mv ethrun /usr/local/bin/ )

nix-channel --add https://nix.dapphub.com/pkgs/dapphub
nix-channel --update
nix-env -i ShellCheck solc seth nodejs hsevm git

make test
sudo make link

dappsys() {
  git -C /tmp clone https://github.com/dapphub/"$1" --recursive
  cd /tmp/"$1"
  dapp test
}

dappsys ds-auth
dappsys ds-exec
dappsys ds-guard
dappsys ds-math
dappsys ds-roles

# dappsys ds-cache
# dappsys ds-multisig
# dappsys ds-token
# dappsys ds-value
# dappsys ds-vault

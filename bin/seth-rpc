#!/usr/bin/env bash
request=`seth rpc-request "$1" -- "${@:2}"`
response=`echo "$request" | seth rpc-curl`

if ! result=`echo "$response" | jshon -Q -e result -j`; then
  echo "$response" | jshon -Q -e error -j
  exit 1
fi

case $result in
  \"*\") result=`echo "[$result]" | jshon -a -u`;;
  \[*\]) result=`echo "$result" | jshon -a -j | while read -r entry; do
    if [[ $entry = \"*\" ]]; then
      echo "[$entry]" | jshon -a -u
    else
      echo "$entry"
    fi
  done`;;
  \{*\}) result=`echo "$result" | jshon -k | while read -r key; do
    value=$(echo "$result" | jshon -e "$key" -j)
    if [[ $value = \"*\" ]]; then
      value=$(echo "[$value]" | jshon -a -u)
    fi
    printf "%-23s %s\n" "$key" "$value"
  done`;;
esac

if [[ $result =~ 0x[[:xdigit:]]+ && ${#result} -lt 20 ]]; then
  result=${result^^} result=${result:2}
  result=`echo "ibase=16; $result" | bc`
fi

echo "$result"
